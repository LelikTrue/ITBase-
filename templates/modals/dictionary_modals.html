{% macro render_field(field, prefix) %}
  <div class="mb-3">
    <label for="{{ prefix }}-{{ field.name }}" class="form-label">
      {{ field.label }}
      {% if field.required %}<span class="text-danger">*</span>{% endif %}
    </label>
    
    {% if field.type == 'textarea' %}
      <textarea class="form-control" id="{{ prefix }}-{{ field.name }}" name="{{ field.name }}" rows="3"></textarea>
    {% elif field.type == 'select' %}
      <div class="input-group">
        <select class="form-select" id="{{ prefix }}-{{ field.name }}" name="{{ field.name }}" {% if field.required %}required{% endif %}>
          <option value="">Выберите...</option>
          <!-- Опции будут загружены динамически JS -->
        </select>
        {% if field.options_from %}
        <button class="btn btn-outline-secondary" type="button" data-bs-toggle="modal" data-bs-target="#{{ field.options_from }}Modal" title="Добавить {{ field.label }}">
          <i class="bi bi-plus-lg"></i>
        </button>
        {% endif %}
      </div>
    {% else %}
      <input type="{{ field.type }}" class="form-control" id="{{ prefix }}-{{ field.name }}" name="{{ field.name }}"
             {% if field.required %}required{% endif %}
             {% if field.maxlength %}maxlength="{{ field.maxlength }}"{% endif %}
             {% if field.placeholder %}placeholder="{{ field.placeholder }}"{% endif %}>
    {% endif %}
    
    {% if field.help_text %}
      <div class="form-text">{{ field.help_text }}</div>
    {% endif %}
  </div>
{% endmacro %}

<!-- Динамическая генерация всех модальных окон -->
{% if dictionary_config %}
  {% for prefix, config in dictionary_config.items() %} {# e.g., prefix='asset-types', config={...} #}
    <div class="modal fade" id="{{ prefix }}Modal" tabindex="-1" aria-labelledby="{{ prefix }}ModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="{{ prefix }}ModalLabel">{{ config.modal_title }}</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="{{ prefix }}Form" novalidate>
              {% for field in config.form_fields %}
                {{ render_field(field, prefix) }}
              {% endfor %}
            </form>
            <div class="alert alert-danger mt-3 d-none" role="alert" id="{{ prefix }}Error"></div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
            <button type="button" class="btn btn-primary" id="save-{{ prefix }}">Сохранить</button>
          </div>
        </div>
      </div>
    </div>
  {% endfor %}
{% endif %}