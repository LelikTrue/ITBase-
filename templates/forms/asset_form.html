{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <h2>{{ title }}</h2>
    {% if error %}
    <div class="alert alert-danger" role="alert">
        {{ error }}
    </div>
    {% endif %}
    <form method="POST" action="{{ url_for('create_asset') }}"> {# Изменено: всегда POST на create_asset #}
        {# Если это форма редактирования, action будет на edit_asset #}
        {# <form method="POST" action="{{ url_for('update_asset', asset_id=asset.id) if asset else url_for('create_asset') }}"> #}
        
        <div class="mb-3">
            <label for="inventory_number" class="form-label">Инвентарный номер <span class="text-danger">*</span></label>
            <input type="text" class="form-control" id="inventory_number" name="inventory_number" required value="{{ asset.inventory_number if asset }}">
        </div>

        <div class="mb-3">
            <label for="serial_number" class="form-label">Серийный номер</label>
            <input type="text" class="form-control" id="serial_number" name="serial_number" value="{{ asset.serial_number if asset }}">
        </div>

        <div class="mb-3">
            <label for="mac_address" class="form-label">MAC адрес</label>
            <input type="text" class="form-control" id="mac_address" name="mac_address" value="{{ asset.mac_address if asset }}">
        </div>

        <div class="mb-3">
            <label for="ip_address" class="form-label">IP адрес</label>
            <input type="text" class="form-control" id="ip_address" name="ip_address" value="{{ asset.ip_address if asset }}">
        </div>

        <div class="mb-3">
            <label for="notes" class="form-label">Заметки</label>
            <textarea class="form-control" id="notes" name="notes" rows="3">{{ asset.notes if asset }}</textarea>
        </div>

        <div class="mb-3">
            <label for="source" class="form-label">Источник <span class="text-danger">*</span></label>
            <input type="text" class="form-control" id="source" name="source" required value="{{ asset.source if asset }}">
        </div>

        <div class="mb-3">
            <label for="purchase_date" class="form-label">Дата покупки</label>
            <input type="date" class="form-control" id="purchase_date" name="purchase_date" value="{{ asset.purchase_date.strftime('%Y-%m-%d') if asset and asset.purchase_date }}">
        </div>

        <div class="mb-3">
            <label for="warranty_end_date" class="form-label">Окончание гарантии</label>
            <input type="date" class="form-control" id="warranty_end_date" name="warranty_end_date" value="{{ asset.warranty_end_date.strftime('%Y-%m-%d') if asset and asset.warranty_end_date }}">
        </div>

        <div class="mb-3">
            <label for="price" class="form-label">Цена</label>
            <input type="number" step="0.01" class="form-control" id="price" name="price" value="{{ asset.price if asset }}">
        </div>

        <div class="mb-3">
            <label for="expected_lifespan_years" class="form-label">Ожидаемый срок службы (годы)</label>
            <input type="number" class="form-control" id="expected_lifespan_years" name="expected_lifespan_years" value="{{ asset.expected_lifespan_years if asset }}">
        </div>

        <div class="mb-3">
            <label for="current_wear_percentage" class="form-label">Текущий износ (%)</label>
            <input type="number" step="0.01" class="form-control" id="current_wear_percentage" name="current_wear_percentage" value="{{ asset.current_wear_percentage if asset }}">
        </div>

        <div class="mb-3">
            <label for="device_model_id" class="form-label">Модель устройства <span class="text-danger">*</span></label>
            <select class="form-select" id="device_model_id" name="device_model_id" required>
                {% for model in device_models %}
                <option value="{{ model.id }}" {% if asset and asset.device_model_id == model.id %}selected{% endif %}>
                    {{ model.name }}
                </option>
                {% endfor %}
            </select>
        </div>

        <div class="mb-3">
            <label for="asset_type_id" class="form-label">Тип актива <span class="text-danger">*</span></label>
            <select class="form-select" id="asset_type_id" name="asset_type_id" required>
                {% for type in asset_types %}
                <option value="{{ type.id }}" {% if asset and asset.asset_type_id == type.id %}selected{% endif %}>
                    {{ type.name }}
                </option>
                {% endfor %}
            </select>
        </div>

        <div class="mb-3">
            <label for="status_id" class="form-label">Статус <span class="text-danger">*</span></label>
            <select class="form-select" id="status_id" name="status_id" required>
                {% for status in device_statuses %} {# Изменено на device_statuses #}
                <option value="{{ status.id }}" {% if asset and asset.status_id == status.id %}selected{% endif %}> {# Изменено на status_id #}
                    {{ status.name }}
                </option>
                {% endfor %}
            </select>
        </div>

        <div class="mb-3">
            <label for="department_id" class="form-label">Отдел</label>
            <select class="form-select" id="department_id" name="department_id">
                <option value="">Не выбран</option> {# Опция для отсутствующего отдела #}
                {% for dept in departments %}
                <option value="{{ dept.id }}" {% if asset and asset.department_id == dept.id %}selected{% endif %}>
                    {{ dept.name }}
                </option>
                {% endfor %}
            </select>
        </div>

        <div class="mb-3">
            <label for="location_id" class="form-label">Местоположение</label>
            <select class="form-select" id="location_id" name="location_id">
                <option value="">Не выбрано</option> {# Опция для отсутствующего местоположения #}
                {% for loc in locations %}
                <option value="{{ loc.id }}" {% if asset and asset.location_id == loc.id %}selected{% endif %}>
                    {{ loc.name }}
                </option>
                {% endfor %}
            </select>
        </div>

        <div class="mb-3">
            <label for="employee_id" class="form-label">Ответственный</label>
            <select class="form-select" id="employee_id" name="employee_id">
                <option value="">Не выбран</option> {# Опция для отсутствующего сотрудника #}
                {% for emp in employees %}
                <option value="{{ emp.id }}" {% if asset and asset.employee_id == emp.id %}selected{% endif %}>
                    {{ emp.first_name }} {{ emp.last_name }}
                </option>
                {% endfor %}
            </select>
        </div>

        {# Если Manufacturer связан с Device напрямую, а не через DeviceModel, добавьте это поле #}
        {# <div class="mb-3">
            <label for="manufacturer_id" class="form-label">Производитель</label>
            <select class="form-select" id="manufacturer_id" name="manufacturer_id">
                <option value="">Не выбран</option>
                {% for mf in manufacturers %}
                <option value="{{ mf.id }}" {% if asset and asset.manufacturer_id == mf.id %}selected{% endif %}>
                    {{ mf.name }}
                </option>
                {% endfor %}
            </select>
        </div> #}

        <div class="d-flex justify-content-between">
            <button type="submit" class="btn btn-primary">{{ 'Сохранить' if asset else 'Добавить' }}</button>
            <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">Отмена</a>
        </div>
    </form>
</div>
{% endblock %}