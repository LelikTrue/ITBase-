{% extends "base.html" %}

{% block title %}Добавить/Редактировать Актив{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="card">
        <div class="card-header">
            <h2 class="mb-0">{{ "Добавить" if device.id is none else "Редактировать" }} Актив</h2>
        </div>
        <div class="card-body">
            {# Убедитесь, что 'create_asset' и 'update_asset' роуты определены в FastAPI #}
            <form id="assetForm" method="post" action="{{ url_for('create_asset') if device.id is none else url_for('update_asset', device_id=device.id) }}">
                <input type="hidden" name="id" value="{{ device.id if device.id is not none else '' }}">

                <div class="mb-3">
                    <label for="inventory_number" class="form-label">Инвентарный номер</label>
                    <input type="text" class="form-control" id="inventory_number" name="inventory_number" value="{{ device.inventory_number if device.inventory_number is not none else '' }}" required>
                </div>

                <div class="mb-3">
                    <label for="serial_number" class="form-label">Серийный номер</label>
                    <input type="text" class="form-control" id="serial_number" name="serial_number" value="{{ device.serial_number if device.serial_number is not none else '' }}">
                </div>

                <div class="mb-3">
                    <label for="mac_address" class="form-label">MAC-адрес</label>
                    <input type="text" class="form-control" id="mac_address" name="mac_address" value="{{ device.mac_address if device.mac_address is not none else '' }}">
                </div>

                <div class="mb-3">
                    <label for="ip_address" class="form-label">IP-адрес</label>
                    <input type="text" class="form-control" id="ip_address" name="ip_address" value="{{ device.ip_address if device.ip_address is not none else '' }}">
                </div>

                <div class="mb-3">
                    <label for="asset_type_id" class="form-label">Тип актива</label>
                    <select class="form-select" id="asset_type_id" name="asset_type_id" required>
                        <option value="">Выберите тип актива</option>
                        {% for type in asset_types %}
                        <option value="{{ type.id }}" {% if device.asset_type_id == type.id %}selected{% endif %}>{{ type.name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="mb-3">
                    <label for="device_model_id" class="form-label">Модель устройства</label>
                    <select class="form-select" id="device_model_id" name="device_model_id" required>
                        <option value="">Выберите модель устройства</option>
                        {% for model in device_models %}
                        <option value="{{ model.id }}" {% if device.device_model_id == model.id %}selected{% endif %}>{{ model.name }} ({{ model.manufacturer.name }})</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="mb-3">
                    <label for="status_id" class="form-label">Статус</label>
                    <select class="form-select" id="status_id" name="status_id" required>
                        <option value="">Выберите статус</option>
                        {% for status in device_statuses %}
                        <option value="{{ status.id }}" {% if device.status_id == status.id %}selected{% endif %}>{{ status.name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="mb-3">
                    <label for="department_id" class="form-label">Отдел</label>
                    <select class="form-select" id="department_id" name="department_id">
                        <option value="">Выберите отдел</option>
                        {% for department in departments %}
                        <option value="{{ department.id }}" {% if device.department_id == department.id %}selected{% endif %}>{{ department.name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="mb-3">
                    <label for="location_id" class="form-label">Местоположение</label>
                    <select class="form-select" id="location_id" name="location_id">
                        <option value="">Выберите местоположение</option>
                        {% for location in locations %}
                        <option value="{{ location.id }}" {% if device.location_id == location.id %}selected{% endif %}>{{ location.name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="mb-3">
                    <label for="employee_id" class="form-label">Сотрудник</label>
                    <select class="form-select" id="employee_id" name="employee_id">
                        <option value="">Выберите сотрудника</option>
                        {% for employee in employees %}
                        <option value="{{ employee.id }}" {% if device.employee_id == employee.id %}selected{% endif %}>{{ employee.first_name }} {{ employee.last_name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="mb-3">
                    <label for="notes" class="form-label">Примечания</label>
                    <textarea class="form-control" id="notes" name="notes" rows="3">{{ device.notes if device.notes is not none else '' }}</textarea>
                </div>

                <div class="mb-3">
                    <label for="source" class="form-label">Источник</label>
                    <input type="text" class="form-control" id="source" name="source" value="{{ device.source if device.source is not none else '' }}" required>
                </div>

                <div class="mb-3">
                    <label for="purchase_date" class="form-label">Дата покупки</label>
                    <input type="date" class="form-control" id="purchase_date" name="purchase_date" value="{{ device.purchase_date.strftime('%Y-%m-%d') if device.purchase_date is not none else '' }}">
                </div>

                <div class="mb-3">
                    <label for="warranty_end_date" class="form-label">Окончание гарантии</label>
                    <input type="date" class="form-control" id="warranty_end_date" name="warranty_end_date" value="{{ device.warranty_end_date.strftime('%Y-%m-%d') if device.warranty_end_date is not none else '' }}">
                </div>

                <div class="mb-3">
                    <label for="price" class="form-label">Цена</label>
                    <input type="number" step="0.01" class="form-control" id="price" name="price" value="{{ device.price if device.price is not none else '' }}">
                </div>

                <div class="mb-3">
                    <label for="image_url" class="form-label">URL изображения</label>
                    <input type="text" class="form-control" id="image_url" name="image_url" value="{{ device.image_url if device.image_url is not none else '' }}">
                </div>

                <div class="mb-3">
                    <label for="acquisition_method" class="form-label">Метод приобретения</label>
                    <input type="text" class="form-control" id="acquisition_method" name="acquisition_method" value="{{ device.acquisition_method if device.acquisition_method is not none else '' }}">
                </div>

                <div class="mb-3">
                    <label for="condition" class="form-label">Состояние</label>
                    <input type="text" class="form-control" id="condition" name="condition" value="{{ device.condition if device.condition is not none else '' }}">
                </div>

                <div class="mb-3">
                    <label for="assigned_date" class="form-label">Дата назначения</label>
                    <input type="date" class="form-control" id="assigned_date" name="assigned_date" value="{{ device.assigned_date.strftime('%Y-%m-%d') if device.assigned_date is not none else '' }}">
                </div>

                <div class="mb-3">
                    <label for="return_date" class="form-label">Дата возврата</label>
                    <input type="date" class="form-control" id="return_date" name="return_date" value="{{ device.return_date.strftime('%Y-%m-%d') if device.return_date is not none else '' }}">
                </div>

                <div class="mb-3">
                    <label for="last_service_date" class="form-label">Дата последнего обслуживания</label>
                    <input type="date" class="form-control" id="last_service_date" name="last_service_date" value="{{ device.last_service_date.strftime('%Y-%m-%d') if device.last_service_date is not none else '' }}">
                </div>

                <div class="mb-3">
                    <label for="next_service_date" class="form-label">Дата следующего обслуживания</label>
                    <input type="date" class="form-control" id="next_service_date" name="next_service_date" value="{{ device.next_service_date.strftime('%Y-%m-%d') if device.next_service_date is not none else '' }}">
                </div>

                <button type="submit" class="btn btn-primary">{{ "Добавить" if device.id is none else "Сохранить изменения" }}</button>
                <a href="{{ url_for('read_assets') }}" class="btn btn-secondary">Отмена</a>
            </form>
        </div>
    </div>
</div>
{% endblock %}